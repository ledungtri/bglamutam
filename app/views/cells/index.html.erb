<h1>Thống Kê Số Lượng Thiếu Nhi Năm Học <%= @current_year_long %></h1>
<h4>Số Lượng các lớp: <%= @cells.count %></h4>

<table>
  <thead>
    <tr>
      <th style="width: 50px">STT</th>
      <th style='width: 100px'>Tên Lớp</th>
      <th style='width: 100px'>Vị Trí</th>
      <th style='width:  94px'>Tổng Số</th>
      <th style='width:  94px'>Nghỉ Luôn</th>
      <th style='width:  94px'>Chuyển Xứ</th>
      <th style='width:  94px'>Đang Học</th>
      <th style='width:  94px'>Dự Thính</th>
      <th style='width:  94px'>Lên Lớp</th>
      <th style='width:  94px'>Học Lại</th>
    </tr>
  </thead>

  <tbody>
    <% @cells.each do |cell| %>
      <tr class="table-row">
        <td style='width: 50px'><%= @cells.index(cell) + 1 %></td>
        <td style='width: 100px'><%= link_to cell.name, cell %></td>
        <td style='width: 100px'><%= cell.location %></td>
        <td style='width:  94px'><%= cell.enrollments.count %></td>
        <td style='width:  94px'><%= cell.enrollments.where(result: 'Nghỉ Luôn').count %></td>
        <td style='width:  94px'><%= cell.enrollments.where(result: 'Chuyển Xứ').count %></td>
        <td style='width:  94px'><%= cell.enrollments.where(result: 'Đang Học').count %></td>
        <td style='width:  94px'><%= cell.enrollments.where(result: 'Dự Thính').count %></td>
        <td style='width:  94px'><%= cell.enrollments.where(result: 'Lên Lớp').count %></td>
        <td style='width:  94px'><%= cell.enrollments.where(result: 'Học Lại').count %></td>
      </tr>
    <% end %>
    <tr class="table-row">
      <td style='width: 50px'></td>
      <td style='width: 100px'>Tổng Số</td>
      <td style='width: 100px'></td>
      <td style='width:  94px'><%= @cells.inject(0) { |sum, cell| sum + cell.enrollments.count } %></td>
      <td style='width:  94px'><%= @cells.inject(0) { |sum, cell| sum + cell.enrollments.where(result: 'Nghỉ Luôn').count } %></td>
      <td style='width:  94px'><%= @cells.inject(0) { |sum, cell| sum + cell.enrollments.where(result: 'Chuyển Xứ').count } %></td>
      <td style='width:  94px'><%= @cells.inject(0) { |sum, cell| sum + cell.enrollments.where(result: 'Đang Học').count } %></td>
      <td style='width:  94px'><%= @cells.inject(0) { |sum, cell| sum + cell.enrollments.where(result: 'Dự Thính').count } %></td>
      <td style='width:  94px'><%= @cells.inject(0) { |sum, cell| sum + cell.enrollments.where(result: 'Lên Lớp').count } %></td>
      <td style='width:  94px'><%= @cells.inject(0) { |sum, cell| sum + cell.enrollments.where(result: 'Học Lại').count } %></td>
    </tr>
  </tbody>
</table>

<%= button_to "In Bảng Thống Kê", cells_path(format: "pdf"), method: :get, :class => "button", params: {year: @current_year} %>
<%= button_to "In Bảng Tự Tạo", cells_custom_export_path, method: :get, :class => "button" %>